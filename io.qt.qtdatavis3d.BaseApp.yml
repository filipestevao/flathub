app-id: io.qt.qtdatavis3d.BaseApp
runtime: org.kde.Platform
runtime-version: "5.15"
sdk: org.kde.Sdk
modules:
- name: qt5-qtdatavis3d
  buildsystem: qmake
  cleanup:
    - /bin
  make-install-args:
    - INSTALL_ROOT=/app/scratchdir
  post-install:
    - cp -r /app/scratchdir/usr/* /app
    - rm -rf /app/scratchdir
    - ln -s /app/lib/*/*.so* /app/lib
  sources:
    - type: archive
      url: http://download.qt.io/archive/qt/5.15/5.15.0/submodules/qtdatavis3d-everywhere-src-5.15.0.tar.xz
      sha256: 8f07747f371f7c515c667240a795105c89aa83c08d88ee92fa1ef7efccea10a3

- name: polish
  buildsystem: simple
  sources:
    - type: file
      path: io.qt.qtdatavis3d.BaseApp.metainfo.xml
    - type: script
      dest-filename: cleanup-BaseApp.sh
      # https://github.com/flatpak/flatpak-builder/issues/233
      commands:
        - export ARCH_TRIPLE=$(gcc --print-multiarch)
        - rm -rfv /app/bin/pprof
        - rm -rfv /app/include
        - rm -rfv /app/lib/mkspecs
        - rm -rfv /app/lib/pkgconfig
        - rm -rfv /app/lib/plugins/designer
        - rm -rfv /app/sbin
        - rm -rfv /app/share/{metainfo,appdata}/io.qt.qtdatavis3d.BaseApp.*.xml
        - rm -rfv /app/share/man
        - rm -rfv /app/share/pci.ids
        - rm -rfv /app/lib/${ARCH_TRIPLE}/cmake
        - rm -rfv /app/lib/${ARCH_TRIPLE}/pkgconfig
        - rm -rfv /app/lib/${ARCH_TRIPLE}/*.prl
        - rm -rfv /app/lib/${ARCH_TRIPLE}/*.la
        - rm -rfv /app/lib/*.a
        - rm -rfv $(readlink -f \"$0\")
  build-commands:
    - sed -e 's@PATHS \"${CMAKE_CURRENT_LIST_DIR}/..\" NO_DEFAULT_PATH@PATHS \"${CMAKE_CURRENT_LIST_DIR}/..\" \"/usr/lib/${CMAKE_CXX_LIBRARY_ARCHITECTURE}/cmake/\" NO_DEFAULT_PATH@' -i /app/lib/*/cmake/*/*Config.cmake
    - sed -e 's@$$QT_MODULE_LIB_BASE@/app/lib@' -i /app/lib/mkspecs/modules/*.pri
    - install -Dm644 io.qt.qtdatavis3d.BaseApp.metainfo.xml -t /app/share/metainfo
    - install cleanup-BaseApp.sh -t /app

